{# -------------------------------------------------------------------------#}
{# File        : ctlabs-ansible/roles/ctlabs_httpd/templates/httpd.conf.j2  #}
{# Description : main httpd.conf                                            #}
{# ------------------------------------------------------------------------ #}

ServerRoot   {{ ctlabs_httpd.defaults.config[ansible_os_family|lower].root_dir   }}
DocumentRoot {{ ctlabs_httpd.defaults.config[ansible_os_family|lower].data_dir   }}
User         {{ ctlabs_httpd.defaults.service.user      }}
Group        {{ ctlabs_httpd.defaults.service.group     }}

ServerAdmin  {{ ctlabs_httpd.defaults.config.admin      }}
ServerName   {{ ctlabs_httpd.defaults.config.servername }}
Listen       {{ ctlabs_httpd.defaults.config.listen     }}

ErrorLog     {{ ctlabs_httpd.defaults.config[ansible_os_family|lower].log.dir }}/{{ ctlabs_httpd.defaults.config[ansible_os_family|lower].log.error }}
LogLevel     {{ ctlabs_httpd.defaults.config[ansible_os_family|lower].log.level }}
Include      conf.modules.d/*.conf


<Directory />
  AllowOverride  None
  Require        all denied
</Directory>

<Directory /var/www>
  AllowOverride  None
  Require        all granted
</Directory>

<Directory /var/www/html>
  Options        Indexes FollowSymLinks
  AllowOverride  None
  Require        all granted
</Directory>

<Files .ht*>
  Require all denied
</Files>

<IfModule dir_module>
  DirectoryIndex index.html
</IfModule>


<IfModule log_config_module>
  LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" combined
  LogFormat "%h %l %u %t \"%r\" %>s %b" common

  <IfModule logio_module>
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" combinedio
  </IfModule>

  CustomLog logs/access_log combined
</IfModule>

<IfModule alias_module>
  ScriptAlias /cgi-bin/ /var/www/cgi-bin/
</IfModule>

<Directory /var/www/cgi-bin>
  AllowOverride  None
  Options        None
  Require        all granted
</Directory>

<IfModule mime_module>
  TypesConfig /etc/mime.types
  AddType  application/x-compress .Z
  AddType  application/x-gzip .gz .tgz
  # AddHandler cgi-script .cgi
  # AddHandler type-map var
  AddType text/html .shtml
  AddOutputFilter  INCLUDES  .shtml
</IfModule>

AddDefaultCharset  UTF-8

<IfModule mime_magic_module>
  MIMEMagicFile conf/magic
</IfModule>

#ErrorDocument 500 "The server made a boo boo"
EnableSendfile on

IncludeOptional conf.d/*.conf
