---

# ------------------------------------------------------------------------------
# File        : ctlabs-ansible/roles/ctlabs_foreman/tasks/config.yml
# Description : configurations
# ------------------------------------------------------------------------------

# make sure the hostname is resolvable via forward/reverse dns


- name: ctlabs_foreman.tasks.config.server.plugins
  when: ctlabs_foreman_role == 'server'
  vars:
    ansible_python_interpreter: /usr/sbin/ip vrf exec default /usr/bin/python3
  command: |
    {{ foreman_installer }} --scenario foreman                \
    --enable-foreman-plugin-ansible                           \
    --enable-foreman-plugin-discovery                         \
    --enable-foreman-plugin-openscap                          \
    --enable-foreman-plugin-remote-execution                  \
    --enable-foreman-plugin-webhooks                          \
    --enable-foreman-plugin-salt                              \
    --enable-foreman-plugin-vault                             \
    --enable-foreman-plugin-netbox                            \
    --enable-foreman-plugin-leapp                             \
    --enable-foreman-cli-openscap
  register: output

#    --enable-foreman-proxy-plugin-openscap-puppet-module true \

- debug: "msg={{ output }}"


- name: ctlabs_foreman.tasks.config.proxy.plugins
  when: ctlabs_foreman_role in [ 'server', 'proxy' ]
  vars:
    ansible_python_interpreter: /usr/sbin/ip vrf exec default /usr/bin/python3
  command: |
    {{ ctlabs_foreman.defaults.install.cmd }} --scenario foreman \
    --enable-foreman-proxy-plugin-openscap                       \
    --enable-foreman-proxy-plugin-remote-execution-script
  register: output

- debug: "msg={{ output }}"
