{# --------------------------------------------------------------------- #}
{# File: ctlabs-ansible/roles/ctlabs_bind/templates/master.named.conf.j2 #}
{# --------------------------------------------------------------------- #}

options {
  listen-on               port 53 { 127.0.0.1; {{ ansible_default_ipv4.address }}; };
  listen-on-v6            port 53 { ::1; };

  directory               "/var/named";
  dump-file               "/var/named/data/cache_dump.db";
  statistics-file         "/var/named/data/named_stats.txt";
  memstatistics-file      "/var/named/data/named_mem_stats.txt";
  secroots-file           "/var/named/data/named.secroots";
  recursing-file          "/var/named/data/named.recursing";

  allow-query             { {{ ctlabs_bind.defaults.config.allow_query|join('; ')}} };
  recursion               {{ ctlabs_bind.defaults.config.recursive }};

  dnssec-validation       yes;

  managed-keys-directory  "/var/named/dynamic";
  geoip-directory         "/usr/share/GeoIP";
  pid-file                "/run/named/named.pid";
  session-keyfile         "/run/named/session.key";
  include                 "/etc/crypto-policies/back-ends/bind.config";
};

logging {
  channel default_debug {
    file      "data/named.run";
    severity  dynamic;
  };
};

zone "." IN {
  type   hint;
  file   "named.ca";
};

{% for zone in ansible_local.ctlabs_bind.zones %}
zone "{{ zone }}" IN {
  type   master;
  file   "data/{{ zone }}.db";
};

{%  endfor %}

include  "/etc/named.rfc1912.zones";
include  "/etc/named.root.key";
