---

# -----------------------------------------------------------------------------------------------------------
# File        : ctlabs-ansible/playbooks/lpic.yml
# Description : setup lpic2 environment
# -----------------------------------------------------------------------------------------------------------

- name  : ctlabs.playbooks.lpic2.bind
  hosts :
    - ns1
    - ns2
  tags  : setup

  tasks:
    - name: ctlabs.playbooks.lpic2.bind.local_facts.dir
      file:
        path : /etc/ansible/facts.d
        state: directory

    - name: ctlabs.playbooks.lpic2.bind.master.local_facts
      when: ansible_hostname == 'ns1'
      copy:
        dest: /etc/ansible/facts.d/ctlabs_bind.fact
        content: |
          {
            "type"   : "master",
            "zones"  : [ "ctlabs.local" ],
            "slaves" : [ "ns2" ]
          }

    - name: ctlabs.playbooks.lpic2.bind.slave.local_facts
      when: ansible_hostname == 'ns2'
      copy:
        dest: /etc/ansible/facts.d/ctlabs_bind.fact
        content: |
          {
            "type"    : "slave",
            "zones"   : [ "ctlabs.local" ],
            "masters" : [ "ns1" ]
          }

    - name: ctlabs.playbooks.lpic2.smbadc.local_facts
      when: ansible_hostname in [ 'dc01', 'dc02' ]
      copy:
        dest: /etc/ansible/facts.d/ctlabs_smbadc.fact
        content: |
          {
            "type"   : "master",
            "domain" : "ctlabs.local"
          }
    

- name  : ctlabs.playbooks.bind
  hosts :
    - ns1
    - ns2
  tags  : bind

  roles :
    - roles/ctlabs_bind

- name  : ctlabs.playbooks.smbadc
  hosts :
    - dc01
    - dc02
  tags  : smbadc

  roles :
    - roles/ctlabs_smbadc

- name  : ctlabs.playbooks.slapd
  hosts :
    - slapd01
    - slapd02
  tags  : slapd

  roles :
    - roles/ctlabs_slapd
    - roles/ctlabs_haproxy
