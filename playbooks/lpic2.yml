---

# -----------------------------------------------------------------------------------------------------------
# File        : ctlabs-ansible/playbooks/lpic2.yml
# Description : setup lpic2 environment used for the labs 2xx
# -----------------------------------------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# ctlabs setup
# -----------------------------------------------------------------------------
- name  : ctlabs.playbooks.lpic2.setup
  hosts : all
  tags  : setup
  tasks :
    - name: ctlabs.playbooks.lpic2.setup.local_facts.dir
      file:
        path : /etc/ansible/facts.d
        state: directory

    - name: ctlabs.playbooks.lpic2.setup.bind.master.local_facts
      when: ansible_hostname == 'ns1'
      copy:
        dest: /etc/ansible/facts.d/ctlabs_bind.fact
        content: |
          {
            "type"   : "master",
            "zones"  : [
              { "name" : "ctlabs.internal" }, 
              { "name" : "svc.ctlabs.internal", "ddns" : { "allow" : [ "127.0.0.1" ] } } 
            ],
            "slaves" : [ "192.168.20.11" ]
          }

    - name: ctlabs.playbooks.lpic2.setup.bind.slave.local_facts
      when: ansible_hostname == 'ns2'
      copy:
        dest: /etc/ansible/facts.d/ctlabs_bind.fact
        content: |
          {
            "type"    : "slave",
            "zones"  : [
              { "name" : "ctlabs.internal" }, 
              { "name" : "svc.ctlabs.internal", "ddns" : { "allow" : [ "127.0.0.1" ] } } 
            ],
            "masters" : [ "192.168.10.11" ]
          }

    - name: ctlabs.playbooks.lpic2.setup.smbadc.local_facts
      when: ansible_hostname in [ 'dc1', 'dc2' ]
      copy:
        dest: /etc/ansible/facts.d/ctlabs_smbadc.fact
        content: |
          {
            "type"   : "master",
            "domain" : "ctlabs.internal"
          }

    - name: ctlabs.playbooks.lpic2.setup.openvpn.server.local_facts
      when: ansible_hostname == 'ro1'
      copy:
        dest: /etc/ansible/facts.d/ctlabs_openvpn.fact
        content: |
          {
            "type"      : "server",
            "server_ip" : "10.8.15.1",
            "client_ip" : "10.8.15.2"
          }

    - name: ctlabs.playbooks.lpic2.setup.openvpn.client.local_facts
      when: ansible_hostname == 'ro2'
      copy:
        dest: /etc/ansible/facts.d/ctlabs_openvpn.fact
        content: |
          {
            "type"      : "client",
            "server_ip" : "10.8.15.1",
            "client_ip" : "10.8.15.2",
            "remote"    : "192.168.16.2"
          }

    - name: ctlabs.playbooks.lpic2.setup.frr.local_facts
      when: ansible_hostname in [ 'ro1', 'ro2' ]
      copy:
        dest: /etc/ansible/facts.d/ctlabs_frr.fact
        content: |
          {
            "daemons" : { 
              "enabled" : [ "bgpd" ],
              "profile" : "datacenter"
            }
          }


# -----------------------------------------------------------------------------
# ctlabs_ca
# -----------------------------------------------------------------------------
    
- name  : ctlabs.playbooks.lpic2.ca
  hosts : all
  tags  : ca
  roles :
    - roles/ctlabs_ca

# -----------------------------------------------------------------------------
# ctlabs_openvpn
# -----------------------------------------------------------------------------
- name  : ctlabs.playbooks.lpic2.openvpn
  hosts :
    - ro1
    - ro2
  tags  : openvpn
  roles :
    - roles/ctlabs_openvpn

# -----------------------------------------------------------------------------
# ctlabs_frr
# -----------------------------------------------------------------------------
- name  : ctlabs.playbooks.lpic2.frr
  hosts :
    - ro1
    - ro2
  tags  : frr
  roles :
    - roles/ctlabs_frr

# -----------------------------------------------------------------------------
# ctlabs_bind
# -----------------------------------------------------------------------------
- name  : ctlabs.playbooks.lpic2.bind
  hosts :
    - ns1
    - ns2
  tags  : bind
  roles :
    - roles/ctlabs_bind

# -----------------------------------------------------------------------------
# ctlabs_smbadc
# -----------------------------------------------------------------------------
- name  : ctlabs.playbooks.lpic2.smbadc
  hosts :
    - dc1
    - dc2
  tags  : smbadc
  roles :
    - roles/ctlabs_smbadc

# -----------------------------------------------------------------------------
# ctlabs_sssd
# -----------------------------------------------------------------------------
- name  : ctlabs.playbooks.lpic2.sssd
  hosts :
    - ns1
    - slapd1
  tags  : sssd
  roles :
    - roles/ctlabs_sssd

# -----------------------------------------------------------------------------
# ctlabs_slapd
# -----------------------------------------------------------------------------
- name  : ctlabs.playbooks.lpic2.slapd
  hosts :
    - slapd1
    - slapd2
  tags  : slapd
  roles :
    - roles/ctlabs_slapd

# -----------------------------------------------------------------------------
# ctlabs_haproxy
# -----------------------------------------------------------------------------
- name  : ctlabs.playbooks.lpic2.haproxy
  hosts :
    - slapd1
    - slapd2
  tags  : haproxy
  roles :
    - roles/ctlabs_haproxy

# -----------------------------------------------------------------------------
# ctlabs_httpd
# -----------------------------------------------------------------------------
- name  : ctlabs.playbooks.lpic2.httpd
  hosts :
    - www1
    - www2
  tags  : httpd
  roles :
    - roles/ctlabs_httpd
